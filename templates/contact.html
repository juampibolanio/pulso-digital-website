{% extends 'base.html' %}

{% block contenido %}

<div class="container-fluid mt-5 pt-3">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-title mb-0">
                        <h4 class="m-0 text-uppercase font-weight-bold">Contactanos</h4>
                    </div>
                    <div class="bg-white border border-top-0 p-4 mb-3">
                        <div class="mb-4">
                            <h6 class="text-uppercase font-weight-bold">INFORMACIÓN DE CONTACTO</h6>
                            <p class="mb-4">¡Completá el formulario y te responderemos a la brevedad! Estamos para ayudarte con cualquier duda, sugerencia o consulta que tengas.</p>
							<div class="mb-3">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fa fa-map-marker-alt text-primary mr-2"></i>
                                    <h6 class="font-weight-bold mb-0">Nuestra oficina</h6>
                                </div>
                                <p class="m-0">Avenida 9 de Julio 1755 (Resistencia)</p>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fa fa-envelope-open text-primary mr-2"></i>
                                    <h6 class="font-weight-bold mb-0">Nuestro Email</h6>
                                </div>
                                <p class="m-0">contacto@pulsodigital.com</p>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fa fa-phone-alt text-primary mr-2"></i>
                                    <h6 class="font-weight-bold mb-0">Nuestro teléfono</h6>
                                </div>
                                <p class="m-0">+054 362 4421623</p>
                            </div>
                        </div>
                        <h6 class="text-uppercase font-weight-bold mb-3">Envianos un mensaje</h6>
                        
                        
                        <form method="post" action="{% url 'apps.noticias:contacto' %}">
    {% csrf_token %}

    <div class="form-row">
        <div class="col-md-6">
            <div class="form-group">
                <input type="text" 
                       name="nombre" 
                       class="form-control p-4" 
                       placeholder="Nombre" 
                       value="{% if user.is_authenticated %}{{ user.get_full_name|default:user.username }}{% endif %}"
                       required>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <input type="email" 
                       name="email" 
                       class="form-control p-4" 
                       placeholder="Email" 
                       value="{% if user.is_authenticated %}{{ user.email }}{% endif %}"
                       {% if user.is_authenticated %}readonly{% endif %}
                       required>
            </div>
        </div>
    </div>

    <!-- Agregar un contenedor para mostrar mensajes de éxito --> 
    <div id="alert-container"></div>
    
    <div class="form-group">
        <input type="text" name="asunto" class="form-control p-4" placeholder="Asunto" required>
    </div>

    <div class="form-group">
        <textarea name="contenido" class="form-control" rows="4" placeholder="Mensaje" required></textarea>
    </div>

    <button class="btn btn-primary font-weight-semi-bold px-4" style="height: 50px; color: white;" type="submit">Enviar mensaje</button>
</form>
                    </div>
                </div>
                <div class="col-lg-4">
                    {% include "componentes/redes_sociales.html" %}
                </div>
            </div>
        </div>
</div>

<!-- Agregar JS para enviar el formulario por AJAX y mostrar mensaje-->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    const alertContainer = document.getElementById('alert-container');

    form.addEventListener('submit', function (e) {
        e.preventDefault(); // evitar recarga
        const formData = new FormData(form);

        fetch("{% url 'apps.noticias:contacto' %}", {
            method: "POST",
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alertContainer.innerHTML = `
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        ${data.message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;
                form.reset();
                
                // Re-llenar los campos del usuario autenticado después del reset
                {% if user.is_authenticated %}
                document.querySelector('input[name="nombre"]').value = '{{ user.get_full_name|default:user.username }}';
                document.querySelector('input[name="email"]').value = '{{ user.email }}';
                {% endif %}
            }
        })
        .catch(error => console.error('Error:', error));
    });
});
</script>

{% endblock %}